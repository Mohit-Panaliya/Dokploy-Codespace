name: Deploy Dokploy to GitHub Codespaces
on:
  push:
    branches: [ main, master ]

jobs:
  codespace-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Verify dev container configuration
        run: |
          if [ -f ".devcontainer/devcontainer.json" ]; then
            echo "Dev container configuration found"
          else
            echo "Error: Dev container configuration not found"
            exit 1
          fi

      - name: Validate Dockerfile
        run: |
          if [ -f ".devcontainer/Dockerfile" ]; then
            echo "Dockerfile found"
          else
            echo "Error: Dockerfile not found"
            exit 1
          fi

      - name: Check dependencies
        run: |
          if [ -f "package.json" ]; then
            echo "package.json found"
            echo "Dependencies:"
            cat package.json | grep -E '"name"|"version"|"pnpm"'
          else
            echo "Error: package.json not found"
            exit 1
          fi

      - name: Verify scripts
        run: |
          if [ -f "package.json" ]; then
            echo "Dokploy scripts available:"
            cat package.json | grep -A 10 '"dokploy"' || true
          fi

      - name: Summary
        run: |
          echo "âœ… Dokploy is compatible with GitHub Codespaces"
          echo "ðŸ“¦ Project uses pnpm $([ -f "package.json" ] && cat package.json | grep -o '"pnpm.*"' || echo "unknown")"
          echo "ðŸ”§ Dev container features: Docker-in-Docker, Git, Go"
          echo "ðŸš€ Ready to deploy on GitHub Codespaces"
